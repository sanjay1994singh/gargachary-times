{% extends 'new_base.html' %}

{% block css %}
<style>
    body, html {
        margin: 0;
        padding: 0;
        width: 100%;
        overflow-x: hidden;
        font-family: Arial, sans-serif;
    }

    /* ðŸ“… Calendar */
    .calendar-container {
        margin: 20px auto;
        text-align: center;
        padding: 10px;
    }
    .calendar-container label {
        display: block;
        margin-bottom: 8px;
        font-size: 16px;
        font-weight: 600;
    }
    .calendar-container input[type="date"] {
        padding: 8px 12px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 8px;
        width: 100%;
        max-width: 250px;
    }

    /* ðŸ“„ PDF Slider */
    .swiper {
        width: 95%;
        max-width: 1000px;
        height: auto;
        margin: 30px auto;
    }
    .swiper-slide {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .swiper-slide canvas {
        width: 100%;
        height: auto;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
        .calendar-container label { font-size: 14px; }
        .calendar-container input[type="date"] { font-size: 14px; }
        .swiper-slide canvas { max-width: 95%; }
    }

    /* Share links */
    .share-links { margin: 10px 0; text-align: center; }
    .share-links a {
        text-decoration: none;
        margin: 0 10px;
        font-size: 24px;
        color: #000;
    }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
{% endblock %}

{% block content %}
<!-- ðŸ“… Calendar -->
<div class="calendar-container">
    <label for="calendar">Select Date:</label>
    <input type="date" id="calendar" name="calendar" value="{{ selected_date }}">

    <!-- Social Share -->
    <div class="share-links">
        <a href="https://wa.me/?text={{ news.title }} - {{ request.build_absolute_uri }}" target="_blank">
            <i class="bi bi-whatsapp"></i>
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" target="_blank">
            <i class="bi bi-facebook"></i>
        </a>
        <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ news.title }}" target="_blank">
            <i class="bi bi-twitter-x"></i>
        </a>
    </div>
</div>

{% if pdf %}
<!-- PDF.js Slider -->
<div class="swiper mySwiper">
    <div class="swiper-wrapper" id="pdf-pages"></div>
    <div class="swiper-pagination"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
</div>
{% else %}
<p style="text-align:center; margin-top:20px;">No PDF available for this date.</p>
{% endif %}
{% endblock %}

{% block js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<script>
$(document).ready(function () {
    // Redirect on calendar change
    $('#calendar').on('change', function () {
        let selectedDate = $(this).val();
        if (selectedDate) {
            window.location.href = "?date=" + selectedDate;
        }
    });

    {% if pdf %}
    // PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";

    const url = "{{ pdf.pdf_file.url }}";
    const loadingTask = pdfjsLib.getDocument(url);

    loadingTask.promise.then(async function(pdf) {
        const container = document.getElementById("pdf-pages");

        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const viewport = page.getViewport({ scale: 1.5 });
            const canvas = document.createElement("canvas");
            const context = canvas.getContext("2d");
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            await page.render({ canvasContext: context, viewport: viewport }).promise;

            const slide = document.createElement("div");
            slide.classList.add("swiper-slide");
            slide.appendChild(canvas);
            container.appendChild(slide);
        }

        // Initialize Swiper
        new Swiper(".mySwiper", {
            loop: false,
            centeredSlides: true, // Center the slides
            spaceBetween: 20,
            pagination: { el: ".swiper-pagination", clickable: true },
            navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" },
        });
    });
    {% endif %}
});
</script>
{% endblock %}
