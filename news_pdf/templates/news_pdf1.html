{% extends 'new_base.html' %}

{% block css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<style>
body, html { margin:0; padding:0; font-family:Arial, sans-serif; }

.swiper {
    width: 95%;
    max-width: 1000px;
    margin: 30px auto;
}
.swiper-slide {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}
.swiper-slide canvas {
    width: 100%;
    max-width: 800px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
.page-number {
    margin-top: 10px;
    font-weight: bold;
}

@media(max-width:768px){
    .swiper-slide canvas { max-width: 95%; }
}
</style>
{% endblock %}

{% block content %}
{% if pdf %}
<div class="swiper mySwiper">
    <div class="swiper-wrapper" id="pdf-pages"></div>
    <div class="swiper-pagination"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
</div>
{% else %}
<p style="text-align:center;margin-top:20px;">No PDF available.</p>
{% endif %}
{% endblock %}

{% block js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
{% if pdf %}
pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";

const url = "{{ pdf.pdf_file.url }}";
const loadingTask = pdfjsLib.getDocument(url);

loadingTask.promise.then(async function(pdf) {
    const container = document.getElementById("pdf-pages");

    for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const viewport = page.getViewport({ scale: 2.5 });
        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        await page.render({ canvasContext: context, viewport: viewport }).promise;

        const slide = document.createElement("div");
        slide.classList.add("swiper-slide");

        // Add page number
        const pageNum = document.createElement("div");
        pageNum.classList.add("page-number");
        pageNum.innerText = "Page " + i + " / " + pdf.numPages;

        slide.appendChild(canvas);
        slide.appendChild(pageNum);
        container.appendChild(slide);
    }

    new Swiper(".mySwiper", {
        loop: false,
        spaceBetween: 20,
        centeredSlides: true,
        pagination: { el: ".swiper-pagination", clickable: true },
        navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" },
    });
});
{% endif %}
</script>
{% endblock %}
